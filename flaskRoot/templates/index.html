<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
		<meta http-equiv="Pragma" content="no-cache" />
		<meta http-equiv="Expires" content="0" />
		
		<title>Raspberry Pi Temperature</title>

		<script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
		<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
	</head>

	<body onload="go()">

		<center>
			<div id="gauge" style="width: 250px; height: 250px"></div>
			<div id="curve_chart" style="width: 1200px; height: 1200px"></div>
		</center>

		<script type='text/javascript'>
			function go(){
				drawGauge();
				drawChart();
				setInterval(function() {
					xTime = new Date();
					console.clear();
					console.log('Updated Chart: '+xTime);
					drawGauge();
					drawChart();
				}, 60000);
			}

			function drawGauge() {
				google.charts.load('current', {packages:['gauge']});
				google.charts.setOnLoadCallback(function(){

					var g2data = new google.visualization.arrayToDataTable([
			              [ {label: 'Temperature', id:'temp', type: 'number'} ]
			              ]);
			        g2data.addRow([ {{ temp1 }} ]);              

			        var options2 = {
			                redFrom: 88, redTo: 120,
			                yellowFrom:78, yellowTo: 120,
			                greenFrom:68, greenTo: 120,
			                minorTicks: 5
			          };

		        	var gauge = new google.visualization.Gauge(document.getElementById('gauge'));
		        	gauge.draw(g2data, options2);
	        	});
	        }

	        function drawChart() {
	        	google.charts.load('current', { packages: ['corechart'] });
	        	google.charts.setOnLoadCallback(function(){
					$.getJSON('/sqlData', function(chartJSON) {
						var chartData = [];
						for (i = 0; i < chartJSON.length; i++){
							chartData.push([new Date(chartJSON[i].Date), chartJSON[i].Temperature]);
						}
						var gdata = new google.visualization.DataTable();
						gdata.addColumn('date', 'Time');
						gdata.addColumn('number', 'Temperature');
						gdata.addRows(chartData);

						var options = {
	            			title: 'Temperture Log',
	            			curveType: 'function',
	            			legend: { position: 'bottom' }
	        			};

	        			var chart = new google.visualization.LineChart(document.getElementById('curve_chart'));
	        			chart.draw(gdata, options);
					});
				});
			}
		</script>
	</body>
</html>
